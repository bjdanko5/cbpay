<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Заполнение списка выбора через AJAX</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #ivcBaseDetails, #lsDetails {
            display: none; /* Скрываем блоки до их наполнения */
        }
    </style>
</head>
<body>
    <form id="myForm">
        <label for="ivcBase">Территория:</label>
        <select id="ivcBase" name="ivcBase">
            <option value="">Выберите...</option>
        </select>
        <br><br>

        <button type="button" id="selectivcBase">Выбрать страну</button>
        <br><br>

        <label for="selectedivcBase">Выбранная страна:</label>
        <input type="text" id="selectedivcBase" name="selectedivcBase" readonly>
        <br><br>

        <div id="ivcBaseDetails">
            <p>Население: <span id="population"></span></p>
            <p>Континент: <span id="continent"></span></p>
        </div>
        <br><br>

        <label for="lsCode">Введите почтовый индекс:</label>
        <input type="text" id="lsCode" name="lsCode" disabled>
        <br><br>

        <button type="button" id="getlsCode" disabled>Найти почтовый индекс</button>
        <br><br>

        <div id="lsDetails">
            <p>Почтовый индекс: <span id="lsIndex"></span></p>
            <p>Население: <span id="lsPopulation"></span></p>
            <p>Континент: <span id="lsContinent"></span></p>
        </div>
    </form>

    <script>
        $(document).ready(function () {
            // AJAX запрос для получения списка стран
            $.ajax({
                url: 'soap.php',
                type: 'POST',
                data: { 'func': 'getivcBases' },
                dataType: 'json',   
                success: function (data) {
                    var select = $('#ivcBase');
                    select.empty(); // Очистим список перед добавлением данных
                    $.each(data, function (index, value) {
                        select.append($('<option>', {
                            value: value.code, // или другое уникальное значение
                            text: value.name  // текст опции
                        }));
                    });
                },
                error: function () {
                    alert('Ошибка при загрузке данных.');
                }
            });

            // Обработчик нажатия на кнопку "Выбрать страну"
            $('#selectivcBase').click(function () {
                var selectedText = $('#ivcBase option:selected').text(); // Получаем текст выбранной страны
                $('#selectedivcBase').val(selectedText); // Устанавливаем его в поле "Выбранная страна"

                var selectedCode = $('#ivcBase').val(); // Получаем код выбранной страны
                if (selectedCode) {
                    $.ajax({
                        url: 'soap.php',
                        type: 'POST',
                        data: { ivcBaseCode: selectedCode }, // Передаем код страны на сервер
                        dataType: 'json',
                        success: function (data) {
                            $('#population').text(data.population); // Выводим население
                            $('#continent').text(data.continent);   // Выводим континент
                            $('#ivcBaseDetails').show(); // Показываем блок с деталями страны
                            $('#lsCode').prop('disabled', false); // Разблокируем поле ввода почтового индекса
                            $('#getlsCode').prop('disabled', false); // Разблокируем кнопку поиска почтового индекса
                        },
                        error: function () {
                            alert('Ошибка при получении данных.');
                        }
                    });
                } else {
                    alert('Пожалуйста, выберите страну.');
                }
            });

            // Обработчик нажатия на кнопку "Найти почтовый индекс"
            $('#getlsCode').click(function () {
                var lsCode = $('#lsCode').val(); // Получаем введенный почтовый индекс
                var selectedCode = $('#ivcBase').val(); // Получаем код выбранной страны
                var population = $('#population').text(); // Получаем население выбранной страны
                var continent = $('#continent').text(); // Получаем континент выбранной страны

                if (lsCode) {
                    $.ajax({
                        url: 'soap.php',
                        type: 'POST',
                        data: {
                            ivcBaseCode: selectedCode,
                            lsCode: lsCode,
                            population: population,
                            continent: continent
                        },
                        dataType: 'json',
                        success: function (data) {
                            $('#lsIndex').text(data.lsCode); // Выводим почтовый индекс
                            $('#lsPopulation').text(data.population); // Выводим население
                            $('#lsContinent').text(data.continent);   // Выводим континент
                            $('#lsDetails').show(); // Показываем блок с деталями почтового индекса
                        },
                        error: function () {
                            alert('Ошибка при получении данных.');
                        }
                    });
                } else {
                    alert('Пожалуйста, введите почтовый индекс.');
                }
            });
        });
    </script>
</body>
</html>
