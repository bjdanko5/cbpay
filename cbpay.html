<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Оплата услуг(AJAX)</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body,
        select,
        input {
            font-family: Verdana, sans-serif;
            font-size: 16px;
        }

        

        #ivcBaseDetails,
        #lsDetails {
          display: none;
            /* Скрываем блоки до их наполнения */
        }

        .mode-switch {
            
            /*display: flex;*/
            display: box;
            justify-content: left;
            margin: 20px 0;
        }
        #territory-btn {
            grid-column: 2;
        }
        
        #access-code-btn {
            grid-column: 3;
        }
        .mode-btn {
           
            background-color: #e0e0e0;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            /*font-size: 16px;*/
        }

        .mode-btn.active {
            background-color: #007bff;
            color: white;
        }

        .mode-content {
            text-align: left;
            margin-top: 20px;
            /*font-size: 18px;*/
            opacity: 0;
            /* Скрыто по умолчанию */
            max-height: 0;
            /* Высота по умолчанию */
            overflow: hidden;
            /* Скрывает содержимое при закрытии */
            transition: opacity 0.5s ease, max-height 0.5s ease;
            /* Переход для плавного изменения */
        }

        .mode-content.active {
            opacity: 1;
            /* Показываем при активном режиме */
            max-height: 500px;
            /* Ограничение высоты (можно настроить) */
        }

        .toggle-mode-switch-btn {
            background-color: #007bff;
            color: #fff;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            /*font-size: 16px;*/
            height: 40px;
        }

        .toggle-mode-switch-btn:hover {
            background-color: #0056b3;
        }

        .toggle-mode-switch-btn:focus {
            outline: none;
        }
    </style>
</head>

<body>


    <form id="myForm">
        <div class="mode-switch">
            <span style="color: #007bff; font-weight: bold;">Поиск : </span>


            <button class="mode-btn active" id="territory-btn" data-mode="territory">По территории</button>
            <button class="mode-btn" id="access-code-btn" data-mode="access-code">По коду доступа</button>

            <div id="territory-selection" class="mode-content">
                <!-- Здесь будет содержимое для выбора "По территории" -->
                <label for="ivcBase"></label>
                <select id="ivcBase" name="ivcBase">
                    <option value="">Выберите...</option>
                </select>
                <br>
            </div>

            <div id="access-code-selection" class="mode-content">
                <!-- Здесь будет содержимое для выбора "По коду доступа" -->
                <label for="AccessCodeLS"></label>
                <input type="text" id="AccessCodeLS" name="AccessCodeLS">
                </select>
                <br>
            </div>
        </div>
        <div id="ivcBaseDetails">

            <span style="color: #007bff; font-weight: bold;">Территория : </span>
            <button class="toggle-mode-switch-btn" id="toggleModeSwitchButton">Изменить</button>
            <br>
            <span id="ivcBaseName"></span>
            <span id="ivcBaseCode" hidden></span>
            <span id="ivcBaseWdsl" hidden> </span>



        </div>
        <br>
        <div id="getLsData">
            <label for="Ls">Лицевой счет:</label>
            <input type="text" id="Ls" name="Ls" disabled>
            <button class="toggle-mode-switch-btn" type="button" id="getlsDataButton" disabled>Обновить</button>
        </div>
        <div id="lsData">
            <p>ЛС: <span id="lsDataLs"></span></p>
            <p>Код базы: <span id="lsDataIvcBaseCode"></span></p>
            <p>Wdsl: <span id="lsDataIvcBaseWdsl"></span></p>
        </div>
    </form>

    <script>
        $(document).ready(function () {
            // AJAX запрос для получения списка баз
            $.ajax({
                url: 'soap.php',
                type: 'POST',
                data: { 'func': 'getivcBases' },
                dataType: 'json',
                success: function (data) {
                    var select = $('#ivcBase');
                    select.empty(); // Очистим список перед добавлением данных
                    select.append($('<option>', {
                        value: 0, // или другое уникальное значение
                        text: 'Выберите...'  // текст опции
                    }));

                    $.each(data, function (index, value) {
                        select.append($('<option>', {
                            value: value.code, // или другое уникальное значение
                            text: value.name  // текст опции
                        }));
                    });
                },
                error: function () {
                    alert('Ошибка при загрузке данных.');
                }
            });
            $('#territory-selection').show();
            $('#territory-selection').addClass('active');
            $('.mode-btn').click(function () {
                event.preventDefault(); // Отменяем стандартное поведение кнопки
                $('.mode-btn').removeClass('active'); // Убираем активный класс со всех кнопок
                $(this).addClass('active'); // Добавляем активный класс на нажатую кнопку

                // Переключаем содержимое в зависимости от выбранного режима
                if ($(this).data('mode') === 'territory') {
                    $('#territory-selection').show();
                    $('#territory-selection').addClass('active');
                    $('#access-code-selection').hide();
                    $('#access-code-selection').removeClass('active');
                } else {
                    $('#access-code-selection').show();
                    $('#access-code-selection').addClass('active');
                    $('#territory-selection').hide();
                    $('#territory-selection').removeClass('active');

                }

            });
            $('#toggleModeSwitchButton').click(function () {
                event.preventDefault(); // Отменяем стандартное поведение кнопки
                $('.mode-switch').find('*').prop('disabled', false);
                $('#getLsData').find('*').prop('disabled', true);
                $('#lsData').hide();

                $('#territory-selection').show();
                $('#access-code-selection').show();
                $('#ivcBaseDetails').toggle();
                $('#ivcBase').val($('#ivcBase option:first').val());

            });
            // Обработчик нажатия на кнопку "Выбрать базу"
            //$('#selectivcBase').click(function () {
            $('#ivcBase').change(function () {

                //$('#selectedivcBase').val(selectedText); // Устанавливаем его в поле "Выбранная база"

                var selectedText = $('#ivcBase option:selected').text(); // Получаем текст выбранной базы 
                var selectedCode = $('#ivcBase').val(); // Получаем код выбранной базы

                if (selectedCode) {
                    $.ajax({
                        url: 'soap.php',
                        type: 'POST',
                        data: { ivcBaseCode: selectedCode }, // Передаем код базы на сервер
                        dataType: 'json',
                        success: function (data) {
                            $('#ivcBaseCode').text(data[0].ivcBaseCode); // Выводим население
                            $('#ivcBaseWdsl').text(data[0].ivcBaseWdsl);   // Выводим континент
                            $('#ivcBaseName').text(data[0].ivcBaseName);   // Выводим континент
                            $('#ivcBaseDetails').show(); // Показываем блок с деталями базы
                            $('#Ls').show();
                            $('#Ls').prop('disabled', false); // Разблокируем поле ввода почтового индекса
                            $('#getLsData').prop('disabled', false); // Разблокируем кнопку поиска почтового индекса
                            $('.mode-switch').find('*').prop('disabled', true);
                            $('#territory-selection').hide();
                            $('#access-code-selection').hide();
                            $('#getlsDataButton').prop('disabled', false);
                        },
                        error: function () {
                            alert('Ошибка при получении данных.');
                        }
                    });
                } else {
                    alert('Пожалуйста, выберите территорию.');
                }
            });

            // Обработчик нажатия на кнопку "Найти ЛС"
            $('#getlsDataButton').click(function () {
                var Ls = $('#Ls').val(); // Получаем введенный ЛС
                var ivcBaseWdsl = $('#ivcBaseWdsl').text(); // Получаем континент выбранной базы
                var ivcBaseCode = $('#ivcBaseCode').text(); 
                if (Ls) {
                    $.ajax({
                        url: 'soap.php',
                        type: 'POST',
                        data: {
                            ivcBaseCode: ivcBaseCode,
                            ivcBaseWdsl: ivcBaseWdsl,
                            Ls: Ls,   
                            func : 'getLsData'                       
                        },
                        dataType: 'json',
                        success: function (data) {
                            $('#lsDataLs').text(data.Ls); // Выводим ЛС
                            $('#lsDataIvcBaseCode').text(data.ivcBaseCode); // Выводим население
                            $('#lsDataIvcBaseWdsl').text(data.ivcBaseWdsl);   // Выводим континент
                            $('#lsData').show(); // Показываем блок с деталями ЛС
                        },
                        error: function () {
                            alert('Ошибка при получении данных.');
                        }
                    });
                } else {
                    alert('Пожалуйста, введите ЛС.');
                }
            });
        });
    </script>
</body>

</html>