<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Заполнение списка выбора через AJAX</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #countryDetails, #postalDetails {
            display: none; /* Скрываем блоки до их наполнения */
        }
    </style>
</head>
<body>
    <form id="myForm">
        <label for="country">Выберите страну:</label>
        <select id="country" name="country">
            <option value="">Загрузка...</option>
        </select>
        <br><br>

        <button type="button" id="selectCountry">Выбрать страну</button>
        <br><br>

        <label for="selectedCountry">Выбранная страна:</label>
        <input type="text" id="selectedCountry" name="selectedCountry" readonly>
        <br><br>

        <div id="countryDetails">
            <p>Население: <span id="population"></span></p>
            <p>Континент: <span id="continent"></span></p>
        </div>
        <br><br>

        <label for="postalCode">Введите почтовый индекс:</label>
        <input type="text" id="postalCode" name="postalCode" disabled>
        <br><br>

        <button type="button" id="getPostalCode" disabled>Найти почтовый индекс</button>
        <br><br>

        <div id="postalDetails">
            <p>Почтовый индекс: <span id="postalIndex"></span></p>
            <p>Население: <span id="postalPopulation"></span></p>
            <p>Континент: <span id="postalContinent"></span></p>
        </div>
    </form>

    <script>
        $(document).ready(function () {
            // AJAX запрос для получения списка стран
            $.ajax({
                url: 'soap.php',
                type: 'POST',
                data: { 'func': 'getCountries' },
                dataType: 'json',   
                success: function (data) {
                    var select = $('#country');
                    select.empty(); // Очистим список перед добавлением данных
                    $.each(data, function (index, value) {
                        select.append($('<option>', {
                            value: value.code, // или другое уникальное значение
                            text: value.name  // текст опции
                        }));
                    });
                },
                error: function () {
                    alert('Ошибка при загрузке данных.');
                }
            });

            // Обработчик нажатия на кнопку "Выбрать страну"
            $('#selectCountry').click(function () {
                var selectedText = $('#country option:selected').text(); // Получаем текст выбранной страны
                $('#selectedCountry').val(selectedText); // Устанавливаем его в поле "Выбранная страна"

                var selectedCode = $('#country').val(); // Получаем код выбранной страны
                if (selectedCode) {
                    $.ajax({
                        url: 'soap.php',
                        type: 'POST',
                        data: { countryCode: selectedCode }, // Передаем код страны на сервер
                        dataType: 'json',
                        success: function (data) {
                            $('#population').text(data.population); // Выводим население
                            $('#continent').text(data.continent);   // Выводим континент
                            $('#countryDetails').show(); // Показываем блок с деталями страны
                            $('#postalCode').prop('disabled', false); // Разблокируем поле ввода почтового индекса
                            $('#getPostalCode').prop('disabled', false); // Разблокируем кнопку поиска почтового индекса
                        },
                        error: function () {
                            alert('Ошибка при получении данных.');
                        }
                    });
                } else {
                    alert('Пожалуйста, выберите страну.');
                }
            });

            // Обработчик нажатия на кнопку "Найти почтовый индекс"
            $('#getPostalCode').click(function () {
                var postalCode = $('#postalCode').val(); // Получаем введенный почтовый индекс
                var selectedCode = $('#country').val(); // Получаем код выбранной страны
                var population = $('#population').text(); // Получаем население выбранной страны
                var continent = $('#continent').text(); // Получаем континент выбранной страны

                if (postalCode) {
                    $.ajax({
                        url: 'soap.php',
                        type: 'POST',
                        data: {
                            countryCode: selectedCode,
                            postalCode: postalCode,
                            population: population,
                            continent: continent
                        },
                        dataType: 'json',
                        success: function (data) {
                            $('#postalIndex').text(data.postalCode); // Выводим почтовый индекс
                            $('#postalPopulation').text(data.population); // Выводим население
                            $('#postalContinent').text(data.continent);   // Выводим континент
                            $('#postalDetails').show(); // Показываем блок с деталями почтового индекса
                        },
                        error: function () {
                            alert('Ошибка при получении данных.');
                        }
                    });
                } else {
                    alert('Пожалуйста, введите почтовый индекс.');
                }
            });
        });
    </script>
</body>
</html>
